-- ============================================================================
-- IAM Contracts - Database Schema Migration Rollback
-- Version: 3 (Rollback)
-- Description: Rollback Authn table names and IDP tables
-- Date: 2025-11-10
-- ============================================================================

-- ============================================================================
-- Step 1: 删除 IDP 表
-- ============================================================================

DROP TABLE IF EXISTS `iam_idp_wechat_apps`;

-- ============================================================================
-- Step 2: 恢复原表名
-- ============================================================================

RENAME TABLE `iam_auth_accounts` TO `iam_authn_accounts`;
RENAME TABLE `iam_auth_credentials` TO `iam_authn_credentials`;
RENAME TABLE `iam_auth_token_audit` TO `iam_authn_token_audit`;

-- ============================================================================
-- Step 3: 删除版本记录
-- ============================================================================

DELETE FROM `iam_schema_version` WHERE `version` = '3.0';

-- ============================================================================
-- Rollback Complete
-- ============================================================================
