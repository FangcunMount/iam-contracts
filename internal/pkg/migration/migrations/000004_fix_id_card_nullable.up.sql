-- ============================================================================
-- Migration 000004: 修复身份证号字段允许为空
-- ============================================================================
-- 问题: iam_users 表的 id_card 字段定义为 NOT NULL，导致多个用户无法使用空值
-- 原因: MySQL 唯一索引允许多个 NULL 值，但只允许一个空字符串 ''
-- 解决: 将 id_card 字段改为允许 NULL，没有身份证的用户存储 NULL 而不是空字符串
-- ============================================================================

-- 修改 iam_users 表的 id_card 字段为可空
ALTER TABLE `iam_users`
    MODIFY COLUMN `id_card` VARCHAR(20) DEFAULT NULL COMMENT '身份证号（可为空）';

-- 将现有的空字符串转换为 NULL（如果有的话）
UPDATE `iam_users`
SET `id_card` = NULL
WHERE `id_card` = '';
