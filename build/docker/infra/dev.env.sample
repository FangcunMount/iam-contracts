# ==========================================
# 开发环境基础设施配置 (dev infra env - sample)
# Copy this file to dev.env and fill secrets before use.
# ==========================================

APP_ENV=development
NODE_ENV=development
LOG_LEVEL=debug
DEBUG=true
TZ=Asia/Shanghai
LANG=zh_CN.UTF-8

NODE_A_IP=127.0.0.1
NODE_B_IP=127.0.0.1
PRIMARY_DOMAIN=localhost

INFRA_DATA_ROOT=/data/infra
INFRA_LOG_ROOT=/data/logs
DATA_ROOT_PATH=/data
LOG_ROOT_PATH=/data/logs

INFRA_BACKEND_SUBNET=172.20.0.0/16
INFRA_BACKEND_GATEWAY=172.20.0.1
INFRA_NETWORK_MTU=1500
INFRA_NETWORK_DRIVER=bridge

INFRA_USER=www
INFRA_GROUP=www

NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443
NGINX_TLS_DIR=/data/nginx/tls
NGINX_MEMORY_LIMIT=128M
NGINX_CPUS=0.25

MYSQL_PORT=3306
MYSQL_ROOT_PASSWORD=dev_root_123
MYSQL_DATABASE=iam_contracts
MYSQL_USER=infra_dev
MYSQL_PASSWORD=dev_pass_123
MYSQL_INNODB_BUFFER_POOL_SIZE=256M
MYSQL_MEMORY_LIMIT=512M
MYSQL_CPUS=0.25

REDIS_CACHE_PORT=6379
REDIS_CACHE_PASSWORD=dev_cache_123
REDIS_CACHE_MAXMEMORY=128mb
REDIS_CACHE_POLICY=allkeys-lfu
REDIS_CACHE_MEM_LIMIT=256M
REDIS_CACHE_CPUS=0.10

REDIS_AUTH_PORT=6380
REDIS_AUTH_PASSWORD=dev_auth_123
REDIS_AUTH_MAXMEMORY=128mb
REDIS_AUTH_MEM_LIMIT=256M
REDIS_AUTH_CPUS=0.10

REDISINSIGHT_PORT=127.0.0.1:5540

REDIS_PORT=${REDIS_CACHE_PORT}
REDIS_PASSWORD=${REDIS_CACHE_PASSWORD}
REDIS_MAXMEMORY=${REDIS_CACHE_MAXMEMORY}
REDIS_MAXMEMORY_POLICY=${REDIS_CACHE_POLICY}

REDIS_STORE_PORT=${REDIS_AUTH_PORT}
REDIS_STORE_PASSWORD=${REDIS_AUTH_PASSWORD}
REDIS_STORE_MAXMEMORY=${REDIS_AUTH_MAXMEMORY}

MONGO_PORT=27017
MONGO_INITDB_ROOT_USERNAME=root
MONGO_INITDB_ROOT_PASSWORD=dev_mongo_123
MONGO_DATABASE=infrastructure_dev

MONGO_MEMORY_LIMIT=512M
MONGO_CPUS=0.20

NSQLOOKUPD_TCP_PORT=4160
NSQLOOKUPD_HTTP_PORT=4161
NSQD_TCP_PORT=4150
NSQD_HTTP_PORT=4151
NSQADMIN_PORT=4171

NSQD_BROADCAST_ADDRESS=${NODE_B_IP}

NSQ_LOOKUPD_TCP_ADDRESSES=${NODE_A_IP}:4160,${NODE_B_IP}:4160

NSQLOOKUPD_MEMORY_LIMIT=64M
NSQLOOKUPD_CPUS=0.10
NSQD_MEMORY_LIMIT=512M
NSQD_CPUS=0.80
NSQADMIN_MEMORY_LIMIT=64M
NSQADMIN_CPUS=0.10

KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
KAFKA_LISTENERS=INTERNAL://0.0.0.0:9092
KAFKA_ADVERTISED_LISTENERS=INTERNAL://${NODE_B_IP}:9092
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INTERNAL:PLAINTEXT
KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL
KAFKA_HEAP_OPTS=-Xms512m -Xmx768m

ENABLE_MANAGEMENT_UI=true

USER_APP_MEMORY_LIMIT=512M
USER_APP_CPUS=0.25

# Security placeholders - replace in your local dev.env
# JWT 签名使用 JWKS (RS256) 非对称密钥，自动生成并持久化到 /app/data/keys
# API_KEY=your_api_key_here

BACKUP_ENABLED=false
BACKUP_RETENTION_DAYS=7
BACKUP_SCHEDULE="0 3 * * *"

METRICS_ENABLED=false
HEALTH_CHECK_ENABLED=true

# Dev notes:
# 1) Copy this file to build/docker/infra/dev.env and replace credentials before use.
# 2) Do NOT commit build/docker/infra/dev.env with secrets into version control.
