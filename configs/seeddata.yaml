# ============================================================================
# IAM Contracts 种子数据配置文件
# ============================================================================
# 描述: 初始化系统所需的基础数据和测试数据
# 版本: 3.0.0
# 更新时间: 2025-10-31
# 说明: 与 scripts/sql/seed.sql 完全同步
# ============================================================================

# ==================== 1. 租户配置 ====================
tenants:
  # 默认租户
  - code: "default"
    name: "默认租户"
    contact_name: "张三"
    contact_phone: "13800138000"
    contact_email: "zhangsan@example.com"
    status: "active"
    max_users: 1000
    max_roles: 100

# ==================== 2. 用户配置 (User Center) ====================
users:
  # 系统管理员
  - alias: "admin"
    name: "系统管理员"
    phone: "10086000001"
    email: "admin@system.com"
    id_card: "110101199001011001"
    status: 1
  
  # 张三
  - alias: "zhangsan"
    name: "张三"
    phone: "13800138000"
    email: "zhangsan@example.com"
    id_card: "110101199001011002"
    status: 1
  
  # 李四
  - alias: "lisi"
    name: "李四"
    phone: "13800138001"
    email: "lisi@example.com"
    id_card: "110101199001011003"
    status: 1
  
  # 王五 (监护人)
  - alias: "wangwu"
    name: "王五"
    phone: "13800138002"
    email: "wangwu@example.com"
    id_card: "110101198001011004"
    status: 1
  
  # 赵六 (监护人)
  - alias: "zhaoliu"
    name: "赵六"
    phone: "13800138003"
    email: "zhaoliu@example.com"
    id_card: "110101198001011005"
    status: 1

# ==================== 3. 儿童配置 (User Center) ====================
children:
  # 小明
  - alias: "xiaoming"
    name: "小明"
    id_card: "110101201501011001"
    gender: 1  # 男
    birthday: "2015-01-01"
    height: 1450  # 145.0cm
    weight: 350   # 35.0kg
  
  # 小红
  - alias: "xiaohong"
    name: "小红"
    id_card: "110101201502011002"
    gender: 2  # 女
    birthday: "2015-02-01"
    height: 1420  # 142.0cm
    weight: 330   # 33.0kg
  
  # 小刚
  - alias: "xiaogang"
    name: "小刚"
    id_card: "110101201603011003"
    gender: 1  # 男
    birthday: "2016-03-01"
    height: 1380  # 138.0cm
    weight: 310   # 31.0kg
  
  # 小丽 (无身份证)
  - alias: "xiaoli"
    name: "小丽"
    id_card: ""  # 无身份证
    gender: 2  # 女
    birthday: "2018-05-15"
    height: 1100  # 110.0cm
    weight: 200   # 20.0kg

# ==================== 4. 监护关系配置 (User Center) ====================
guardianships:
  # 王五是小明的父亲
  - user_alias: "wangwu"
    child_alias: "xiaoming"
    relation: "father"
  
  # 赵六是小红的母亲
  - user_alias: "zhaoliu"
    child_alias: "xiaohong"
    relation: "mother"
  
  # 王五是小刚的监护人
  - user_alias: "wangwu"
    child_alias: "xiaogang"
    relation: "guardian"
  
  # 赵六是小丽的母亲
  - user_alias: "zhaoliu"
    child_alias: "xiaoli"
    relation: "mother"

# ==================== 5. 认证账号配置 (Authentication) ====================
accounts:
  # 系统管理员 - 运营账号
  - alias: "admin_account"
    user_alias: "admin"
    provider: "operation"
    external_id: "admin"
    username: "admin"
    password: "Admin@123"  # 注意: 生产环境应使用强密码
    app_id: ""
    status: 1
  
  # 张三 - 运营账号
  - alias: "zhangsan_account"
    user_alias: "zhangsan"
    provider: "operation"
    external_id: "zhangsan"
    username: "zhangsan"
    password: "Pass@123"
    app_id: ""
    status: 1
  
  # 王五 - 微信账号
  - alias: "wangwu_wechat"
    user_alias: "wangwu"
    provider: "wechat"
    external_id: "wangwu_openid_123"
    username: ""
    password: ""
    app_id: "wx1234567890abcdef"
    status: 1
    # 微信扩展信息
    wechat_open_id: "wangwu_openid_123"
    wechat_union_id: "wangwu_unionid_456"
    wechat_nickname: "王五"
    wechat_avatar_url: "https://example.com/avatar/wangwu.jpg"

# ==================== 6. 授权资源配置 (Authorization) ====================
resources:
  # 用户管理资源
  - alias: "res_uc_users"
    key: "uc:users"
    display_name: "用户管理"
    app_name: "iam"
    domain: "uc"
    type: "collection"
    actions: ["create", "read", "update", "delete", "list"]
    description: "用户中心的用户管理权限"
  
  # 儿童管理资源
  - alias: "res_uc_children"
    key: "uc:children"
    display_name: "儿童管理"
    app_name: "iam"
    domain: "uc"
    type: "collection"
    actions: ["create", "read", "update", "delete", "list"]
    description: "用户中心的儿童档案管理权限"
  
  # 监护关系管理资源
  - alias: "res_uc_guardianships"
    key: "uc:guardianships"
    display_name: "监护关系管理"
    app_name: "iam"
    domain: "uc"
    type: "collection"
    actions: ["create", "read", "update", "delete", "list", "revoke"]
    description: "用户中心的监护关系管理权限"
  
  # 角色管理资源
  - alias: "res_authz_roles"
    key: "authz:roles"
    display_name: "角色管理"
    app_name: "iam"
    domain: "authz"
    type: "collection"
    actions: ["create", "read", "update", "delete", "list", "assign"]
    description: "授权模块的角色管理权限"
  
  # 策略管理资源
  - alias: "res_authz_policies"
    key: "authz:policies"
    display_name: "策略管理"
    app_name: "iam"
    domain: "authz"
    type: "collection"
    actions: ["create", "read", "update", "delete", "list"]
    description: "授权模块的策略管理权限"

# ==================== 7. 角色分配配置 (Authorization) ====================
assignments:
  # 系统管理员拥有 super_admin 角色
  - subject_type: "user"
    subject_id: "1000000000000001"  # 系统管理员 (注意: 这个ID将通过别名引用替换)
    role_id: 1  # super_admin
    tenant_id: "default"
    granted_by: "system"
  
  # 张三拥有 user 角色
  - subject_type: "user"
    subject_id: "1000000000000002"  # 张三 (注意: 这个ID将通过别名引用替换)
    role_id: 3  # user
    tenant_id: "default"
    granted_by: "system"
  
  # 王五拥有 user 角色
  - subject_type: "user"
    subject_id: "1000000000000004"  # 王五 (注意: 这个ID将通过别名引用替换)
    role_id: 3  # user
    tenant_id: "default"
    granted_by: "system"

# ==================== 8. Casbin 策略配置 (Authorization) ====================
policies:
  # 角色策略: super_admin 可以对所有资源执行所有操作
  - type: "p"
    subject: "role:super_admin"
    values: ["*", "*", "allow"]
  
  # 角色策略: tenant_admin 可以管理租户内资源
  - type: "p"
    subject: "role:tenant_admin"
    values: ["tenant:*", "*", "allow"]
  
  # 角色策略: user 只能读取和更新自己的信息
  - type: "p"
    subject: "role:user"
    values: ["user:self", "read", "allow"]
  
  - type: "p"
    subject: "role:user"
    values: ["user:self", "update", "allow"]
  
  # 角色继承: super_admin 继承 tenant_admin
  - type: "g"
    subject: "role:super_admin"
    values: ["role:tenant_admin"]
  
  # 角色继承: tenant_admin 继承 user
  - type: "g"
    subject: "role:tenant_admin"
    values: ["role:user"]

# ==================== 9. JWKS 密钥配置 (Authentication) ====================
jwks:
  key_id: "rsa-key-2025-10-31"
  algorithm: "RS256"
  key_size: 2048
  valid_years: 1

# ==================== 10. 微信应用配置 (IDP - WeChat) ====================
wechat_apps:
  # 问卷笔记本小程序
  - alias: "questionnaire_notebook"
    app_id: "wx72ade250b619a649"
    name: "问卷笔记本小程序"
    type: "MiniProgram"
    status: "Enabled"
    app_secret: "d3a4a12cbffb569423a786317cca6cae"  # 生产环境中应通过环境变量或密钥管理系统设置
  