# GitHub Actions CI/CD æ–‡ä»¶æ¸…å•

æœ¬æ¬¡åˆ›å»ºçš„æ‰€æœ‰ GitHub Actions ç›¸å…³æ–‡ä»¶æ¸…å•ï¼š

## ğŸ“ å·¥ä½œæµæ–‡ä»¶ï¼ˆ`.github/workflows/`ï¼‰

### 1. æ ¸å¿ƒå·¥ä½œæµ

| æ–‡ä»¶å | ç”¨é€” | è§¦å‘æ–¹å¼ |
|--------|------|---------|
| `cicd.yml` | ä¸» CI/CD æµç¨‹ | Push, PR, æ ‡ç­¾, æ‰‹åŠ¨ |
| `server-check.yml` | æœåŠ¡å™¨å¥åº·æ£€æŸ¥ | å®šæ—¶ï¼ˆæ¯å°æ—¶ï¼‰, æ‰‹åŠ¨ |
| `db-ops.yml` | æ•°æ®åº“æ“ä½œ | æ‰‹åŠ¨ |
| `ping-runner.yml` | Runner è¿é€šæ€§æµ‹è¯• | å®šæ—¶ï¼ˆæ¯å¤©ï¼‰, æ‰‹åŠ¨ |

### 2. é…ç½®æ–‡ä»¶

| æ–‡ä»¶å | ç”¨é€” |
|--------|------|
| `secrets.example` | Secrets é…ç½®æ¨¡æ¿ |
| `README.md` | å·¥ä½œæµè¯¦ç»†æ–‡æ¡£ |
| `QUICKSTART.md` | å¿«é€Ÿå¯åŠ¨æŒ‡å— |
| `BADGES.md` | çŠ¶æ€å¾½ç« é…ç½® |

---

## ğŸ“ å·¥ä½œæµè¯¦ç»†è¯´æ˜

### `cicd.yml` - CI/CD Pipeline

**åŠŸèƒ½æ¨¡å—ï¼š**

#### CI é˜¶æ®µ
1. **Lintï¼ˆä»£ç æ£€æŸ¥ï¼‰**
   - golangci-lint ä»£ç æ£€æŸ¥
   - gofmt æ ¼å¼æ£€æŸ¥
   
2. **Testï¼ˆå•å…ƒæµ‹è¯•ï¼‰**
   - è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
   - ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Š
   - ä¸Šä¼ åˆ° Codecov
   - ä½¿ç”¨ MySQL å’Œ Redis æœåŠ¡å®¹å™¨

3. **Buildï¼ˆæ„å»ºï¼‰**
   - æ„å»ºå¤šå¹³å°äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆLinux amd64/arm64ï¼‰
   - åµŒå…¥ç‰ˆæœ¬ä¿¡æ¯
   - ä¸Šä¼ æ„å»ºäº§ç‰©

4. **Docker Buildï¼ˆé•œåƒæ„å»ºï¼‰**
   - æ„å»ºå¤šæ¶æ„ Docker é•œåƒ
   - æ¨é€åˆ° Docker Hub
   - è‡ªåŠ¨æ ‡ç­¾ç®¡ç†

#### CD é˜¶æ®µ
5. **Deploy Devï¼ˆå¼€å‘ç¯å¢ƒï¼‰**
   - éƒ¨ç½²åˆ°å¼€å‘æœåŠ¡å™¨
   - äºŒè¿›åˆ¶éƒ¨ç½²æ–¹å¼
   - è‡ªåŠ¨é‡å¯æœåŠ¡

6. **Deploy Stagingï¼ˆé¢„å‘å¸ƒç¯å¢ƒï¼‰**
   - Docker Compose éƒ¨ç½²
   - å†’çƒŸæµ‹è¯•éªŒè¯

7. **Deploy Productionï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰**
   - åˆ›å»ºå¤‡ä»½
   - è“ç»¿éƒ¨ç½²
   - å¥åº·æ£€æŸ¥
   - å¤±è´¥è‡ªåŠ¨å›æ»š
   - åˆ›å»º GitHub Release

#### é€šçŸ¥é˜¶æ®µ
8. **Notifyï¼ˆé€šçŸ¥ï¼‰**
   - æˆåŠŸé€šçŸ¥
   - å¤±è´¥æ—¶è‡ªåŠ¨åˆ›å»º Issue

**è§¦å‘æ¡ä»¶ï¼š**
- Push åˆ° `main`ã€`develop`ã€`release/**` åˆ†æ”¯
- Pull Request åˆ° `main`ã€`develop`
- åˆ›å»ºæ ‡ç­¾ `v*.*.*`
- æ‰‹åŠ¨è§¦å‘

---

### `server-check.yml` - Server Health Check

**åŠŸèƒ½ï¼š**
- âœ… API ç«¯ç‚¹å¥åº·æ£€æŸ¥
- âœ… API ç‰ˆæœ¬éªŒè¯
- âœ… API å“åº”æ—¶é—´ç›‘æ§
- âœ… æ•°æ®åº“è¿æ¥æ£€æŸ¥
- âœ… SSL è¯ä¹¦æœ‰æ•ˆæœŸæ£€æŸ¥
- âœ… æœåŠ¡å™¨èµ„æºç›‘æ§
- âœ… è®¤è¯æµç¨‹æµ‹è¯•

**æ£€æŸ¥ç±»å‹ï¼š**
- `full` - å®Œæ•´æ£€æŸ¥ï¼ˆæ‰€æœ‰é¡¹ç›®ï¼‰
- `quick` - å¿«é€Ÿæ£€æŸ¥ï¼ˆåŸºæœ¬è¿é€šæ€§ï¼‰
- `api-only` - API ä¸“é¡¹æ£€æŸ¥
- `database-only` - æ•°æ®åº“ä¸“é¡¹æ£€æŸ¥

**è§¦å‘æ¡ä»¶ï¼š**
- å®šæ—¶ä»»åŠ¡ï¼šæ¯å°æ—¶ä¸€æ¬¡
- æ‰‹åŠ¨è§¦å‘

**ç‰¹æ€§ï¼š**
- ç”Ÿäº§ç¯å¢ƒå¤±è´¥è‡ªåŠ¨åˆ›å»º Issue
- SSL è¯ä¹¦åˆ°æœŸé¢„è­¦ï¼ˆ30 å¤©å†…ï¼‰

---

### `db-ops.yml` - Database Operations

**æ”¯æŒçš„æ“ä½œï¼š**

1. **Health Checkï¼ˆå¥åº·æ£€æŸ¥ï¼‰**
   - æ•°æ®åº“è¿æ¥æµ‹è¯•
   - è¡¨åˆ—è¡¨æŸ¥è¯¢
   - æ•°æ®åº“å¤§å°ç»Ÿè®¡

2. **Backupï¼ˆå¤‡ä»½ï¼‰**
   - å®Œæ•´æ•°æ®åº“å¤‡ä»½
   - è‡ªåŠ¨å‹ç¼©
   - æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™ 30 å¤©ï¼‰

3. **Migrateï¼ˆè¿ç§»ï¼‰**
   - æ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬
   - æ›´æ–°æ¶æ„

4. **Seedï¼ˆæ•°æ®å¡«å……ï¼‰**
   - å¡«å……æµ‹è¯•æ•°æ®
   - ä»…é™éç”Ÿäº§ç¯å¢ƒ

**è§¦å‘æ¡ä»¶ï¼š**
- æ‰‹åŠ¨è§¦å‘ï¼ˆé€‰æ‹©æ“ä½œç±»å‹å’Œç¯å¢ƒï¼‰

---

### `ping-runner.yml` - Ping Runner

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤º Runner ç³»ç»Ÿä¿¡æ¯
- æµ‹è¯•ç½‘ç»œè¿é€šæ€§
- æ£€æŸ¥ Docker å¯ç”¨æ€§
- æ£€æŸ¥ Go ç¯å¢ƒ
- ç”Ÿæˆå¥åº·æŠ¥å‘Š

**è§¦å‘æ¡ä»¶ï¼š**
- å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤©å‡Œæ™¨ 1:00 UTCï¼ˆåŒ—äº¬æ—¶é—´ 9:00ï¼‰
- æ‰‹åŠ¨è§¦å‘

---

## ğŸ” æ‰€éœ€ GitHub Secrets

### å¿…éœ€ Secrets

```bash
# Docker Hub
DOCKER_USERNAME          # Docker Hub ç”¨æˆ·å
DOCKER_PASSWORD          # Docker Hub Token

# API URLs
DEV_API_URL             # å¼€å‘ç¯å¢ƒ API åœ°å€
STAGING_API_URL         # é¢„å‘å¸ƒç¯å¢ƒ API åœ°å€
PROD_API_URL            # ç”Ÿäº§ç¯å¢ƒ API åœ°å€

# æ•°æ®åº“é…ç½®ï¼ˆæ¯ä¸ªç¯å¢ƒï¼‰
DB_HOST_{env}           # æ•°æ®åº“ä¸»æœº
DB_PORT_{env}           # æ•°æ®åº“ç«¯å£
DB_NAME_{env}           # æ•°æ®åº“åç§°
DB_USER_{env}           # æ•°æ®åº“ç”¨æˆ·
DB_PASSWORD_{env}       # æ•°æ®åº“å¯†ç 

# SSH é…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºå¥åº·æ£€æŸ¥ï¼‰
SERVER_HOST_{env}       # æœåŠ¡å™¨ä¸»æœº
SERVER_USER_{env}       # SSH ç”¨æˆ·
SSH_PRIVATE_KEY_{env}   # SSH ç§é’¥
```

**æ³¨æ„ï¼š** `{env}` ä¸º `dev`ã€`staging` æˆ– `prod`

### å¯é€‰ Secrets

```bash
CODECOV_TOKEN           # Codecov ä¸Šä¼  Token
SLACK_WEBHOOK_URL       # Slack é€šçŸ¥ Webhook
```

---

## ğŸ“š æ–‡æ¡£æ–‡ä»¶è¯´æ˜

### `README.md`
å®Œæ•´çš„å·¥ä½œæµæ–‡æ¡£ï¼ŒåŒ…å«ï¼š
- å·¥ä½œæµè¯¦ç»†è¯´æ˜
- é…ç½®æŒ‡å—
- ä½¿ç”¨ç¤ºä¾‹
- æ•…éšœæ’æŸ¥
- æœ€ä½³å®è·µ

### `QUICKSTART.md`
5 åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨æŒ‡å—ï¼š
- å¿«é€Ÿé…ç½®æ­¥éª¤
- æµ‹è¯•éªŒè¯æµç¨‹
- å¸¸è§é—®é¢˜è§£å†³
- ä¸‹ä¸€æ­¥å»ºè®®

### `BADGES.md`
GitHub å¾½ç« é…ç½®ï¼š
- CI/CD çŠ¶æ€å¾½ç« 
- ä¸åŒæ ·å¼ç¤ºä¾‹
- README é›†æˆç¤ºä¾‹

### `secrets.example`
Secrets é…ç½®æ¨¡æ¿ï¼š
- å®Œæ•´çš„ Secrets åˆ—è¡¨
- é…ç½®ç¤ºä¾‹
- å®‰å…¨æ³¨æ„äº‹é¡¹

---

## ğŸš€ å¿«é€Ÿå¼€å§‹æµç¨‹

### 1. é…ç½® Secrets
```bash
1. è¿›å…¥ GitHub ä»“åº“ Settings
2. å¯¼èˆªåˆ° Secrets and variables -> Actions
3. æ ¹æ® secrets.example æ·»åŠ å¿…éœ€çš„ Secrets
```

### 2. æµ‹è¯• CI
```bash
git checkout -b test/ci-setup
echo "test" > test.txt
git add test.txt
git commit -m "test: CI setup"
git push origin test/ci-setup
# åˆ›å»º PR è§‚å¯Ÿ CI è¿è¡Œ
```

### 3. æµ‹è¯•éƒ¨ç½²
```bash
# å¼€å‘ç¯å¢ƒ
git push origin develop

# é¢„å‘å¸ƒç¯å¢ƒ
git checkout -b release/v0.1.0
git push origin release/v0.1.0

# ç”Ÿäº§ç¯å¢ƒ
git tag v0.1.0
git push origin v0.1.0
```

---

## ğŸ¯ å·¥ä½œæµçŸ©é˜µ

| å·¥ä½œæµ | å¼€å‘ | é¢„å‘å¸ƒ | ç”Ÿäº§ | é¢‘ç‡ |
|--------|------|--------|------|------|
| `cicd.yml` | âœ… | âœ… | âœ… | Push/PR/æ ‡ç­¾ |
| `server-check.yml` | âœ… | âœ… | âœ… | æ¯å°æ—¶ |
| `db-ops.yml` | âœ… | âœ… | âœ… | æ‰‹åŠ¨ |
| `ping-runner.yml` | N/A | N/A | N/A | æ¯å¤© |

---

## ğŸ“Š å·¥ä½œæµä¾èµ–å…³ç³»

```
cicd.yml
â”œâ”€â”€ lint
â”œâ”€â”€ test
â”œâ”€â”€ build
â”‚   â”œâ”€â”€ binary (amd64)
â”‚   â””â”€â”€ binary (arm64)
â”œâ”€â”€ docker-build
â””â”€â”€ deploy
    â”œâ”€â”€ deploy-dev (develop åˆ†æ”¯)
    â”œâ”€â”€ deploy-staging (release/* åˆ†æ”¯)
    â””â”€â”€ deploy-prod (v*.*.* æ ‡ç­¾)

server-check.yml
â”œâ”€â”€ health-check
â”œâ”€â”€ api-check
â”œâ”€â”€ database-check
â””â”€â”€ ssl-check

db-ops.yml
â”œâ”€â”€ health-check
â”œâ”€â”€ backup
â”œâ”€â”€ migrate
â””â”€â”€ seed

ping-runner.yml
â””â”€â”€ system-check
```

---

## âœ… éªŒè¯æ¸…å•

é…ç½®å®Œæˆåï¼Œè¯·ç¡®è®¤ï¼š

- [ ] æ‰€æœ‰å¿…éœ€çš„ Secrets å·²é…ç½®
- [ ] ping-runner å·¥ä½œæµè¿è¡ŒæˆåŠŸ
- [ ] CI å·¥ä½œæµï¼ˆlint, test, buildï¼‰é€šè¿‡
- [ ] å¼€å‘ç¯å¢ƒéƒ¨ç½²æˆåŠŸ
- [ ] server-check å·¥ä½œæµè¿è¡Œæ­£å¸¸
- [ ] æ–‡æ¡£å·²æ·»åŠ çŠ¶æ€å¾½ç« 

---

## ğŸ”„ ç»´æŠ¤å»ºè®®

### å®šæœŸæ£€æŸ¥ï¼ˆæ¯æœˆï¼‰
- [ ] æ›´æ–° GitHub Actions ç‰ˆæœ¬
- [ ] æ£€æŸ¥å¹¶è½®æ¢ Secrets
- [ ] å®¡æŸ¥å·¥ä½œæµæ€§èƒ½
- [ ] æ¸…ç†æ—§çš„æ„å»ºäº§ç‰©
- [ ] æ›´æ–°æ–‡æ¡£

### å®‰å…¨å®¡è®¡ï¼ˆæ¯å­£åº¦ï¼‰
- [ ] å®¡æŸ¥ Secrets æƒé™
- [ ] æ£€æŸ¥ self-hosted runner å®‰å…¨
- [ ] å®¡è®¡ç¬¬ä¸‰æ–¹ Actions
- [ ] æ›´æ–°ä¾èµ–ç‰ˆæœ¬

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚é‡é—®é¢˜ï¼š
1. æŸ¥çœ‹ `.github/workflows/README.md`
2. å‚è€ƒ `.github/workflows/QUICKSTART.md`
3. æ£€æŸ¥å·¥ä½œæµæ—¥å¿—
4. åœ¨ä»“åº“ä¸­åˆ›å»º Issue

---

**åˆ›å»ºæ—¥æœŸï¼š** 2025-10-21  
**ç‰ˆæœ¬ï¼š** 1.0.0  
**ç»´æŠ¤è€…ï¼š** DevOps Team
