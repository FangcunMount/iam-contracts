# æ¡†æ¶è®¾è®¡æ€»è§ˆ

## ğŸ¯ è®¾è®¡ç†å¿µ

iam contracts åŸºäº**å…­è¾¹å½¢æ¶æ„ï¼ˆHexagonal Architectureï¼‰**è®¾è®¡ï¼Œä¹Ÿç§°ä¸ºç«¯å£ä¸é€‚é…å™¨æ¨¡å¼ï¼ˆPorts and Adapters Patternï¼‰ã€‚è¿™ç§æ¶æ„çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸šåŠ¡é€»è¾‘ä¸å¤–éƒ¨ä¾èµ–åˆ†ç¦»ï¼Œä½¿ç³»ç»Ÿæ›´åŠ çµæ´»ã€å¯æµ‹è¯•å’Œå¯ç»´æŠ¤ã€‚

## ğŸ—ï¸ æ¶æ„å±‚æ¬¡

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Interface Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   REST API  â”‚  â”‚   gRPC API  â”‚  â”‚   CLI       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Application Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Services  â”‚  â”‚   DTOs      â”‚  â”‚   Mappers   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Domain Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Entities  â”‚  â”‚   Ports     â”‚  â”‚   Services  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Infrastructure Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   MySQL     â”‚  â”‚   Redis     â”‚  â”‚   HTTP      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```text
iam-contracts/
â”œâ”€â”€ cmd/                           # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â””â”€â”€ apiserver/                # APIæœåŠ¡å™¨å…¥å£
â”œâ”€â”€ configs/                      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ apiserver.yaml           # å®Œæ•´é…ç½®
â”‚   â”œâ”€â”€ apiserver-simple.yaml    # ç®€åŒ–é…ç½®
â”‚   â””â”€â”€ env/                     # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ internal/                     # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ apiserver/               # APIæœåŠ¡å™¨æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ application/         # åº”ç”¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ user/           # ç”¨æˆ·åº”ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ auth/           # è®¤è¯åº”ç”¨æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ container/          # ä¾èµ–æ³¨å…¥å®¹å™¨
â”‚   â”‚   â”‚   â””â”€â”€ assembler/      # æ¨¡å—ç»„è£…å™¨
â”‚   â”‚   â”œâ”€â”€ domain/             # é¢†åŸŸå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ user/           # ç”¨æˆ·é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ port/           # ç«¯å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ infrastructure/     # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ mysql/          # MySQLé€‚é…å™¨
â”‚   â”‚   â”‚   â””â”€â”€ redis/          # Redisé€‚é…å™¨
â”‚   â”‚   â””â”€â”€ interface/          # æ¥å£å±‚
â”‚   â”‚       â”œâ”€â”€ restful/        # REST API
â”‚   â”‚       â””â”€â”€ grpc/           # gRPC API
â”‚   â””â”€â”€ pkg/                    # å†…éƒ¨å…±äº«åŒ…
â”‚       â”œâ”€â”€ options/            # é…ç½®é€‰é¡¹
â”‚       â”œâ”€â”€ server/             # æœåŠ¡å™¨ç»„ä»¶
â”‚       â””â”€â”€ middleware/         # ä¸­é—´ä»¶
â”œâ”€â”€ pkg/                        # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ database/               # æ•°æ®åº“æŠ½è±¡
â”‚   â”œâ”€â”€ log/                    # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ errors/                 # é”™è¯¯å¤„ç†
â”‚   â””â”€â”€ auth/                   # è®¤è¯å·¥å…·
â””â”€â”€ scripts/                    # è„šæœ¬å·¥å…·
    â””â”€â”€ base/                   # è„šæœ¬åŸºç¡€åº“
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. ä¾èµ–æ³¨å…¥å®¹å™¨ (Container)

è´Ÿè´£ç®¡ç†æ‰€æœ‰æ¨¡å—çš„ä¾èµ–æ³¨å…¥å’Œç”Ÿå‘½å‘¨æœŸï¼Œå®ç°æ¾è€¦åˆçš„æ¨¡å—ç»„è£…ã€‚

```go
container := container.NewContainer(mysqlDB)
container.Initialize()
```

### 2. æ•°æ®åº“æ³¨å†Œå™¨ (Registry)

æä¾›ç»Ÿä¸€çš„æ•°æ®åº“è¿æ¥ç®¡ç†ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ç±»å‹ã€‚

```go
registry := database.NewRegistry()
registry.Register(databases.MySQL, config, connection)
```

### 3. é…ç½®ç®¡ç† (Options)

åŸºäºViperçš„é…ç½®ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§é…ç½®æºã€‚

```go
opts := options.NewOptions()
viper.Unmarshal(opts)
```

### 4. æ—¥å¿—ç³»ç»Ÿ (Log)

åŸºäºZapçš„é«˜æ€§èƒ½æ—¥å¿—ç³»ç»Ÿï¼Œæ”¯æŒç»“æ„åŒ–æ—¥å¿—ã€‚

```go
log.Init(&log.Options{
    Level: "info",
    Format: "json",
})
```

## ğŸ¨ è®¾è®¡åŸåˆ™

### 1. ä¾èµ–å€’ç½®åŸåˆ™ (DIP)

- é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—
- æŠ½è±¡ä¸ä¾èµ–å…·ä½“å®ç°
- å…·ä½“å®ç°ä¾èµ–æŠ½è±¡

### 2. å•ä¸€èŒè´£åŸåˆ™ (SRP)

- æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸ
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
- é«˜å†…èšã€ä½è€¦åˆ

### 3. å¼€é—­åŸåˆ™ (OCP)

- å¯¹æ‰©å±•å¼€æ”¾
- å¯¹ä¿®æ”¹å…³é—­
- é€šè¿‡æ¥å£å®ç°æ‰©å±•

### 4. æ¥å£éš”ç¦»åŸåˆ™ (ISP)

- å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£
- æ¥å£åº”è¯¥å°è€Œç²¾ç¡®
- é¿å…èƒ–æ¥å£

## ğŸ”„ æ•°æ®æµ

```text
HTTP Request â†’ Middleware â†’ Handler â†’ Service â†’ Repository â†’ Database
                â†“
HTTP Response â† Middleware â† Handler â† Service â† Repository â† Database
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

- é¢†åŸŸé€»è¾‘æµ‹è¯•
- åº”ç”¨æœåŠ¡æµ‹è¯•
- å·¥å…·å‡½æ•°æµ‹è¯•

### 2. é›†æˆæµ‹è¯•

- æ•°æ®åº“é›†æˆæµ‹è¯•
- APIé›†æˆæµ‹è¯•
- å®¹å™¨é›†æˆæµ‹è¯•

### 3. ç«¯åˆ°ç«¯æµ‹è¯•

- å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
- æ€§èƒ½æµ‹è¯•
- å‹åŠ›æµ‹è¯•

## ğŸ“ˆ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°æ¨¡å—

1. åœ¨`domain`å±‚å®šä¹‰å®ä½“å’Œç«¯å£
2. åœ¨`application`å±‚å®ç°åº”ç”¨æœåŠ¡
3. åœ¨`infrastructure`å±‚å®ç°é€‚é…å™¨
4. åœ¨`interface`å±‚å®ç°APIæ¥å£
5. åœ¨`container`å±‚ç»„è£…æ¨¡å—

### æ·»åŠ æ–°æ•°æ®åº“

1. å®ç°`DatabaseConnection`æ¥å£
2. åœ¨`databases`åŒ…ä¸­æ³¨å†Œæ–°ç±»å‹
3. æ›´æ–°é…ç½®é€‰é¡¹
4. æ·»åŠ ç›¸åº”çš„é€‚é…å™¨

## ğŸ¯ æœ€ä½³å®è·µ

1. **ä¿æŒé¢†åŸŸçº¯å‡€**: é¢†åŸŸå±‚ä¸ä¾èµ–å¤–éƒ¨æ¡†æ¶
2. **ä½¿ç”¨ä¾èµ–æ³¨å…¥**: é€šè¿‡å®¹å™¨ç®¡ç†ä¾èµ–å…³ç³»
3. **ç»Ÿä¸€é”™è¯¯å¤„ç†**: ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯ç å’Œæ¶ˆæ¯
4. **ç»“æ„åŒ–æ—¥å¿—**: ä½¿ç”¨å­—æ®µåŒ–æ—¥å¿—è®°å½•
5. **é…ç½®å¤–éƒ¨åŒ–**: æ‰€æœ‰é…ç½®éƒ½åº”è¯¥å¯é…ç½®
6. **å¥åº·æ£€æŸ¥**: æä¾›å®Œæ•´çš„å¥åº·æ£€æŸ¥æœºåˆ¶
