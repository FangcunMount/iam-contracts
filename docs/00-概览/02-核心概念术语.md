# æ ¸å¿ƒæ¦‚å¿µæœ¯è¯­

> ğŸ“– IAM ç³»ç»Ÿé¢†åŸŸæœ¯è¯­è¡¨ä¸æ¦‚å¿µå…³ç³»å›¾

---

## 1. é¢†åŸŸæœ¯è¯­

### 1.1 è®¤è¯åŸŸ (Authn)

| æœ¯è¯­ | è‹±æ–‡ | å®šä¹‰ |
|------|------|------|
| **è´¦æˆ·** | Account | ç”¨æˆ·çš„è®¤è¯èº«ä»½ï¼ŒåŒ…å«å¤šç§å‡­è¯ |
| **å‡­è¯** | Credential | è®¤è¯å‡­æ®ï¼Œå¦‚å¾®ä¿¡ OpenIDã€å¯†ç ç­‰ |
| **ä»¤ç‰Œ** | Token | JWT æ ¼å¼çš„è®¿é—®å‡­è¯ |
| **è®¿é—®ä»¤ç‰Œ** | Access Token | çŸ­æœŸæœ‰æ•ˆï¼ˆ15åˆ†é’Ÿï¼‰ï¼Œç”¨äº API è®¿é—® |
| **åˆ·æ–°ä»¤ç‰Œ** | Refresh Token | é•¿æœŸæœ‰æ•ˆï¼ˆ7å¤©ï¼‰ï¼Œç”¨äºåˆ·æ–°è®¿é—®ä»¤ç‰Œ |
| **ä¼šè¯** | Session | ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå­˜å‚¨åœ¨ Redis |
| **JWKS** | JSON Web Key Set | JWT å…¬é’¥é›†ï¼Œä¸šåŠ¡æœåŠ¡å¯è‡ªè¡ŒéªŒç­¾ |

### 1.2 æˆæƒåŸŸ (Authz)

| æœ¯è¯­ | è‹±æ–‡ | å®šä¹‰ |
|------|------|------|
| **ä¸»ä½“** | Subject | è¯·æ±‚æƒé™çš„å®ä½“ï¼Œé€šå¸¸æ˜¯ç”¨æˆ· |
| **èµ„æº** | Resource/Object | è¢«è®¿é—®çš„å¯¹è±¡ï¼Œå¦‚ `user`ã€`child` |
| **æ“ä½œ** | Action | å¯¹èµ„æºçš„æ“ä½œï¼Œå¦‚ `read`ã€`write` |
| **è§’è‰²** | Role | æƒé™çš„é›†åˆï¼Œå¦‚ `admin`ã€`guardian` |
| **ç­–ç•¥** | Policy | æˆæƒè§„åˆ™ï¼Œå®šä¹‰è°å¯ä»¥åšä»€ä¹ˆ |
| **RBAC** | Role-Based Access Control | åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ |

### 1.3 ç”¨æˆ·åŸŸ (UC)

| æœ¯è¯­ | è‹±æ–‡ | å®šä¹‰ |
|------|------|------|
| **ç”¨æˆ·** | User | ç³»ç»Ÿä¸­çš„æˆå¹´ç”¨æˆ· |
| **å„¿ç«¥** | Child | æœªæˆå¹´äººæ¡£æ¡ˆï¼Œç”±ç›‘æŠ¤äººç®¡ç† |
| **ç›‘æŠ¤äºº** | Guardian | å¯¹å„¿ç«¥æœ‰ç›‘æŠ¤æƒçš„ç”¨æˆ· |
| **ç›‘æŠ¤å…³ç³»** | Guardianship | ç›‘æŠ¤äººä¸å„¿ç«¥ä¹‹é—´çš„ç»‘å®šå…³ç³» |

---

## 2. æ¶æ„æœ¯è¯­

### 2.1 å…­è¾¹å½¢æ¶æ„

| æœ¯è¯­ | è‹±æ–‡ | å®šä¹‰ |
|------|------|------|
| **ç«¯å£** | Port | é¢†åŸŸå±‚å®šä¹‰çš„æ¥å£ï¼ˆè¾“å…¥/è¾“å‡ºï¼‰ |
| **é€‚é…å™¨** | Adapter | ç«¯å£çš„å…·ä½“å®ç° |
| **é©±åŠ¨é€‚é…å™¨** | Driving Adapter | è°ƒç”¨åº”ç”¨çš„å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ REST APIï¼‰ |
| **è¢«é©±åŠ¨é€‚é…å™¨** | Driven Adapter | è¢«åº”ç”¨è°ƒç”¨çš„å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚æ•°æ®åº“ï¼‰ |

### 2.2 DDD æ¦‚å¿µ

| æœ¯è¯­ | è‹±æ–‡ | å®šä¹‰ |
|------|------|------|
| **èšåˆ** | Aggregate | ä¸€ç»„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œæœ‰èšåˆæ ¹ |
| **èšåˆæ ¹** | Aggregate Root | èšåˆçš„å…¥å£ç‚¹ï¼Œä¿è¯ä¸€è‡´æ€§ |
| **å®ä½“** | Entity | æœ‰å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡ |
| **å€¼å¯¹è±¡** | Value Object | æ— æ ‡è¯†ï¼Œç”±å±æ€§å®šä¹‰çš„å¯¹è±¡ |
| **é¢†åŸŸæœåŠ¡** | Domain Service | ä¸å±äºä»»ä½•å®ä½“çš„é¢†åŸŸé€»è¾‘ |
| **é¢†åŸŸäº‹ä»¶** | Domain Event | é¢†åŸŸä¸­å‘ç”Ÿçš„é‡è¦äº‹ä»¶ |
| **ä»“å‚¨** | Repository | èšåˆçš„æŒä¹…åŒ–æ¥å£ |

### 2.3 CQRS

| æœ¯è¯­ | è‹±æ–‡ | å®šä¹‰ |
|------|------|------|
| **å‘½ä»¤** | Command | æ”¹å˜ç³»ç»ŸçŠ¶æ€çš„æ“ä½œï¼ˆå†™ï¼‰ |
| **æŸ¥è¯¢** | Query | ä¸æ”¹å˜çŠ¶æ€çš„è¯»å–æ“ä½œ |
| **åº”ç”¨æœåŠ¡** | Application Service | å¤„ç†å‘½ä»¤ï¼Œç¼–æ’é¢†åŸŸå¯¹è±¡ |
| **æŸ¥è¯¢æœåŠ¡** | Query Service | å¤„ç†æŸ¥è¯¢ï¼Œå¯ç›´æ¥è¯»æ•°æ®åº“ |

---

## 3. æ¦‚å¿µå…³ç³»å›¾

### 3.1 è®¤è¯åŸŸæ¦‚å¿µå…³ç³»

```mermaid
graph TB
    subgraph "è®¤è¯åŸŸ"
        Account[è´¦æˆ· Account]
        Credential[å‡­è¯ Credential]
        Session[ä¼šè¯ Session]
        Token[ä»¤ç‰Œ Token]
        JWKS[å…¬é’¥é›† JWKS]
        
        Account -->|åŒ…å«å¤šä¸ª| Credential
        Account -->|åˆ›å»º| Session
        Session -->|ç”Ÿæˆ| Token
        Token -->|éªŒè¯éœ€è¦| JWKS
    end
```

### 3.2 æˆæƒåŸŸæ¦‚å¿µå…³ç³»

```mermaid
graph TB
    subgraph "æˆæƒåŸŸ"
        Subject[ä¸»ä½“ Subject]
        Role[è§’è‰² Role]
        Policy[ç­–ç•¥ Policy]
        Resource[èµ„æº Resource]
        Action[æ“ä½œ Action]
        
        Subject -->|æ‹¥æœ‰| Role
        Role -->|åŒ…å«| Policy
        Policy -->|æˆæƒ| Resource
        Policy -->|å…è®¸| Action
    end
```

### 3.3 ç”¨æˆ·åŸŸæ¦‚å¿µå…³ç³»

```mermaid
graph TB
    subgraph "ç”¨æˆ·åŸŸ"
        User[ç”¨æˆ· User]
        Child[å„¿ç«¥ Child]
        Guardian[ç›‘æŠ¤äºº Guardian]
        Guardianship[ç›‘æŠ¤å…³ç³» Guardianship]
        
        User -->|è§’è‰²| Guardian
        Guardian -->|å»ºç«‹| Guardianship
        Guardianship -->|å…³è”| Child
    end
```

### 3.4 è·¨åŸŸå…³ç³»

```mermaid
graph LR
    subgraph "ç”¨æˆ·åŸŸ UC"
        User[ç”¨æˆ·]
    end
    
    subgraph "è®¤è¯åŸŸ Authn"
        Account[è´¦æˆ·]
        Token[ä»¤ç‰Œ]
    end
    
    subgraph "æˆæƒåŸŸ Authz"
        Role[è§’è‰²]
        Permission[æƒé™]
    end
    
    User -->|1:1| Account
    Account -->|ç­¾å‘| Token
    User -->|æ‹¥æœ‰| Role
    Role -->|åŒ…å«| Permission
    Token -->|æºå¸¦| Role
```

---

## 4. ç¼©å†™å¯¹ç…§

| ç¼©å†™ | å…¨ç§° | è¯´æ˜ |
|------|------|------|
| IAM | Identity & Access Management | èº«ä»½ä¸è®¿é—®ç®¡ç† |
| UC | User Center | ç”¨æˆ·ä¸­å¿ƒ |
| Authn | Authentication | è®¤è¯ |
| Authz | Authorization | æˆæƒ |
| JWT | JSON Web Token | JSON ç½‘ç»œä»¤ç‰Œ |
| JWKS | JSON Web Key Set | JSON ç½‘ç»œå¯†é’¥é›† |
| RBAC | Role-Based Access Control | åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ |
| DDD | Domain-Driven Design | é¢†åŸŸé©±åŠ¨è®¾è®¡ |
| CQRS | Command Query Responsibility Segregation | å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦» |
