# ç”¨æˆ·ä¸­å¿ƒï¼ˆUC Moduleï¼‰æ¶æ„è®¾è®¡

> è´Ÿè´£ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å„¿ç«¥æ¡£æ¡ˆç®¡ç†ä»¥åŠç›‘æŠ¤å…³ç³»ç®¡ç†

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | è¯´æ˜ | å†…å®¹ |
|------|------|------|
| **æœ¬æ–‡æ¡£** | æ¨¡å—æ¦‚è¿° | è®¾è®¡ç›®æ ‡ã€æ ¸å¿ƒèŒè´£ã€æŠ€æœ¯ç‰¹æ€§ |
| [é¢†åŸŸæ¨¡å‹](./DOMAIN_MODELS.md) | DDD è®¾è®¡ | èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡è¯¦è§£ |
| [æ¶æ„è®¾è®¡](./ARCHITECTURE.md) | åˆ†å±‚æ¶æ„ | å…­è¾¹å½¢æ¶æ„ã€CQRS å®ç° |
| [API è®¾è®¡](./API_DESIGN.md) | æ¥å£æ–‡æ¡£ | RESTful APIã€gRPC API |
| [æ•°æ®æ¨¡å‹](./DATA_MODELS.md) | æ•°æ®åº“è®¾è®¡ | ER å›¾ã€è¡¨ç»“æ„ |
| [ä¸šåŠ¡æµç¨‹](./BUSINESS_FLOWS.md) | æµç¨‹è¯¦è§£ | æ³¨å†Œã€ç»‘å®šã€æŸ¥è¯¢æµç¨‹ |

---

## 1. æ¨¡å—æ¦‚è¿°

ç”¨æˆ·ä¸­å¿ƒï¼ˆUser Center, UCï¼‰æ˜¯ IAM å¹³å°çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œè´Ÿè´£ç®¡ç†ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸã€å„¿ç«¥æ¡£æ¡ˆä»¥åŠç›‘æŠ¤å…³ç³»ã€‚

### 1.1 è®¾è®¡ç›®æ ‡

- âœ… **é¢†åŸŸé©±åŠ¨**: åŸºäº DDD æˆ˜æœ¯è®¾è®¡ï¼Œæ¸…æ™°çš„é¢†åŸŸè¾¹ç•Œ
- âœ… **å…­è¾¹å½¢æ¶æ„**: ä¸šåŠ¡é€»è¾‘ä¸åŸºç¡€è®¾æ–½å®Œå…¨è§£è€¦
- âœ… **CQRS æ¨¡å¼**: å‘½ä»¤ä¸æŸ¥è¯¢èŒè´£åˆ†ç¦»
- âœ… **é«˜å†…èšä½è€¦åˆ**: é€šè¿‡ç«¯å£é€‚é…å™¨å®ç°ä¾èµ–å€’ç½®

### 1.2 æŠ€æœ¯ç‰¹æ€§

| ç‰¹æ€§ | å®ç°æ–¹å¼ |
|------|---------|
| **äº‹åŠ¡ç®¡ç†** | Unit of Work (UoW) æ¨¡å¼ |
| **å¹¶å‘æ§åˆ¶** | ä¹è§‚é”ï¼ˆGORM ç‰ˆæœ¬å­—æ®µï¼‰ |
| **æ•°æ®éªŒè¯** | å€¼å¯¹è±¡è‡ªåŒ…å«éªŒè¯ |
| **é”™è¯¯å¤„ç†** | ç»Ÿä¸€é”™è¯¯ç  + é”™è¯¯åŒ…è£… |
| **æ—¥å¿—è¿½è¸ª** | ç»“æ„åŒ–æ—¥å¿— + è¯·æ±‚ ID |

---

## 2. æ ¸å¿ƒèŒè´£

### 2.1 ç”¨æˆ·ç®¡ç†

- **æ³¨å†Œ**: åˆ›å»ºæ–°ç”¨æˆ·è´¦å·
- **èµ„æ–™ç»´æŠ¤**: æ›´æ–°å§“åã€è”ç³»æ–¹å¼ã€èº«ä»½è¯
- **çŠ¶æ€ç®¡ç†**: æ¿€æ´»ã€åœç”¨ã€å°ç¦

### 2.2 å„¿ç«¥æ¡£æ¡ˆç®¡ç†

- **æ¡£æ¡ˆåˆ›å»º**: æ³¨å†Œå„¿ç«¥åŸºæœ¬ä¿¡æ¯
- **ä¿¡æ¯ç»´æŠ¤**: æ›´æ–°å§“åã€æ€§åˆ«ã€ç”Ÿæ—¥ã€èº«é«˜ä½“é‡
- **æŸ¥é‡æ£€æµ‹**: åŸºäºå§“å+ç”Ÿæ—¥æŸ¥æ‰¾ç›¸ä¼¼å„¿ç«¥

### 2.3 ç›‘æŠ¤å…³ç³»ç®¡ç†

- **å…³ç³»æˆäºˆ**: å»ºç«‹ç”¨æˆ·ä¸å„¿ç«¥çš„ç›‘æŠ¤å…³ç³»
- **å…³ç³»æ’¤é”€**: è§£é™¤ç›‘æŠ¤æƒé™
- **å…³ç³»æŸ¥è¯¢**: æŸ¥è¯¢ç›‘æŠ¤äººçš„æ‰€æœ‰å„¿ç«¥ã€å„¿ç«¥çš„æ‰€æœ‰ç›‘æŠ¤äºº

---

## 3. æ¶æ„äº®ç‚¹

### 3.1 é¢†åŸŸæ¨¡å‹

```text
User (èšåˆæ ¹)        Child (èšåˆæ ¹)
     â”‚                    â”‚
     â”‚                    â”‚
     â””â”€â”€â–º Guardianship â—„â”€â”€â”˜
          (èšåˆæ ¹)
```

**ä¸‰ä¸ªèšåˆæ ¹**:
- **User**: ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…å«è”ç³»æ–¹å¼ã€èº«ä»½è¯ç­‰å€¼å¯¹è±¡
- **Child**: å„¿ç«¥æ¡£æ¡ˆï¼ŒåŒ…å«ç”Ÿæ—¥ã€èº«é«˜ä½“é‡ç­‰å€¼å¯¹è±¡
- **Guardianship**: ç›‘æŠ¤å…³ç³»ï¼Œè¿æ¥ç”¨æˆ·å’Œå„¿ç«¥

è¯¦è§ï¼š[é¢†åŸŸæ¨¡å‹æ–‡æ¡£](./DOMAIN_MODELS.md)

### 3.2 åˆ†å±‚æ¶æ„

```text
HTTP/gRPC (é€‚é…å™¨)
    â†“
Application (åº”ç”¨æœåŠ¡)
    â†“
Domain (é¢†åŸŸå±‚)
    â†“
Infrastructure (åŸºç¡€è®¾æ–½)
```

**CQRS å®ç°**:
- **Command**: ä¿®æ”¹çŠ¶æ€ï¼Œä½¿ç”¨èšåˆæ ¹å’Œä»“å‚¨
- **Query**: åªè¯»æŸ¥è¯¢ï¼Œç›´æ¥ä½¿ç”¨æŸ¥è¯¢æœåŠ¡

è¯¦è§ï¼š[æ¶æ„è®¾è®¡æ–‡æ¡£](./ARCHITECTURE.md)

### 3.3 API è®¾è®¡

**RESTful API**:
- `GET /me` - è·å–å½“å‰ç”¨æˆ·èµ„æ–™
- `PATCH /me` - æ›´æ–°ç”¨æˆ·èµ„æ–™
- `POST /children/register` - æ³¨å†Œå„¿ç«¥ï¼ˆè‡ªåŠ¨å»ºç«‹ç›‘æŠ¤å…³ç³»ï¼‰
- `GET /me/children` - æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„æ‰€æœ‰å„¿ç«¥
- `POST /guardians/grant` - æˆäºˆç›‘æŠ¤æƒ

**gRPC API**:
- `GetUser` - è·å–ç”¨æˆ·ä¿¡æ¯
- `GetChild` - è·å–å„¿ç«¥ä¿¡æ¯
- `IsGuardian` - åˆ¤æ–­ç›‘æŠ¤å…³ç³»
- `ListChildrenByUserID` - æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰å„¿ç«¥

è¯¦è§ï¼š[API è®¾è®¡æ–‡æ¡£](./API_DESIGN.md)

---

## 4. å¿«é€Ÿå¼€å§‹

### 4.1 æ³¨å†Œç”¨æˆ·

> **æ³¨æ„**: ç”¨æˆ·æ³¨å†Œé€šè¿‡è®¤è¯ä¸­å¿ƒï¼ˆAuthnï¼‰æ¨¡å—å®Œæˆï¼ŒåŒ…å«è´¦å·åˆ›å»ºã€å¯†ç è®¾ç½®ç­‰åŠŸèƒ½ã€‚
> UC æ¨¡å—ä¸“æ³¨äºç”¨æˆ·èµ„æ–™ç®¡ç†ï¼Œä¸ç›´æ¥æä¾›æ³¨å†Œç«¯ç‚¹ã€‚

```bash
# é€šè¿‡è®¤è¯ä¸­å¿ƒæ³¨å†Œï¼ˆåˆ›å»ºè´¦å· + ç”¨æˆ·èµ„æ–™ï¼‰
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "password": "your_password"
  }'
```

### 4.2 æ³¨å†Œå„¿ç«¥

```bash
# æ³¨å†Œå„¿ç«¥å¹¶è‡ªåŠ¨å»ºç«‹ç›‘æŠ¤å…³ç³»
curl -X POST http://localhost:8080/api/v1/children/register \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{
    "name": "å¼ å°æ˜",
    "gender": 1,
    "dob": "2018-05-20"
  }'
```

### 4.3 æˆäºˆç›‘æŠ¤æƒ

```bash
curl -X POST http://localhost:8080/api/v1/guardians/grant \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{
    "child_id": "chd_456",
    "relation": "parent"
  }'
```

### 4.4 æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰å„¿ç«¥

```bash
curl -H "Authorization: Bearer {token}" \
  http://localhost:8080/api/v1/me/children
```

---

## 5. æ ¸å¿ƒä¼˜åŠ¿

### 5.1 DDD æˆ˜æœ¯è®¾è®¡

- âœ… **èšåˆæ ¹æ˜ç¡®**: Userã€Childã€Guardianship å„è‡ªç‹¬ç«‹
- âœ… **å€¼å¯¹è±¡å°è£…**: Phoneã€Emailã€IDCard è‡ªåŒ…å«éªŒè¯
- âœ… **é¢†åŸŸæœåŠ¡**: æŸ¥é‡æ£€æµ‹ã€å…³ç³»éªŒè¯ç­‰ä¸šåŠ¡é€»è¾‘

### 5.2 å…­è¾¹å½¢æ¶æ„

- âœ… **ä¸šåŠ¡ç‹¬ç«‹**: Domain å±‚ä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æ¡†æ¶
- âœ… **ç«¯å£é€‚é…å™¨**: HTTPã€gRPC å‡å¯æ¥å…¥
- âœ… **å¯æµ‹è¯•æ€§**: ä¸šåŠ¡é€»è¾‘å¯ç‹¬ç«‹æµ‹è¯•

### 5.3 CQRS æ¨¡å¼

- âœ… **è¯»å†™åˆ†ç¦»**: Command ä¿®æ”¹ï¼ŒQuery æŸ¥è¯¢
- âœ… **æ€§èƒ½ä¼˜åŒ–**: æŸ¥è¯¢å¯ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæ— éœ€åŠ è½½èšåˆæ ¹
- âœ… **æ‰©å±•æ€§**: å¯ç‹¬ç«‹ä¼˜åŒ–è¯»å†™è·¯å¾„

---

## 6. æœ€ä½³å®è·µ

### 6.1 é¢†åŸŸå±‚

- âœ… èšåˆæ ¹è´Ÿè´£ç»´æŠ¤ä¸šåŠ¡ä¸å˜æ€§
- âœ… å€¼å¯¹è±¡è‡ªåŒ…å«éªŒè¯é€»è¾‘
- âœ… é¢†åŸŸäº‹ä»¶ç”¨äºè§£è€¦èšåˆæ ¹

### 6.2 åº”ç”¨å±‚

- âœ… åº”ç”¨æœåŠ¡ç¼–æ’ä¸šåŠ¡æµç¨‹
- âœ… ä½¿ç”¨ UoW ç®¡ç†äº‹åŠ¡è¾¹ç•Œ
- âœ… Command å’Œ Query èŒè´£åˆ†ç¦»

### 6.3 é€‚é…å™¨å±‚

- âœ… DTO ä¸é¢†åŸŸå¯¹è±¡åˆ†ç¦»
- âœ… HTTP/gRPC é€‚é…å™¨è–„å±‚åŒ–
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

---

## 7. ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿæ¶æ„æ€»è§ˆ](../architecture-overview.md) - æ•´ä½“æ¶æ„è®¾è®¡
- [è®¤è¯ä¸­å¿ƒ](../authn/README.md) - JWT è®¤è¯ä¸ç™»å½•
- [æˆæƒä¸­å¿ƒ](../authorization/README.md) - RBAC æƒé™æ§åˆ¶

---

**æœ€åæ›´æ–°**: 2025-11-20  
**ç»´æŠ¤å›¢é˜Ÿ**: IAM Team
